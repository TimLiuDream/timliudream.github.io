<!DOCTYPE html>
<html lang="en">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<title>golang中的iota用法 - tim</title>

<meta name="description" content="有些概念有名字，并且有时候我们关注这些名字，甚至（特别）是在我们代码中。
const ( CCVisa = &#34;Visa&#34; CCMasterCard = &#34;MasterCard&#34; CCAmericanExpress = &#34;American Express&#34; ) 在其他时候，我们仅仅关注能把一个东西与其他的做区分。有些时候，有些时候一件事没有本质上的意义。比如，我们在一个数据库表中存储产品，我们可能不想以 string 存储他们的分类。我们不关注这个分类是怎样命名的，此外，该名字在市场上一直在变化。
我们仅仅关注它们是怎么彼此区分的。
const ( CategoryBooks = 0 CategoryHealth = 1 CategoryClothing = 2 ) 使用 0, 1, 和 2 代替，我们也可以选择 17， 43， 和 61。这些值是任意的。
常量是重要的，但是它们很难推断，并且难以维护。在一些语言中像 Ruby 开发者通常只是避免它们。在 Go，常量有许多微妙之处。当用好了，可以使得代码非常优雅且易维护的
 自增长 在 golang 中，一个方便的习惯就是使用 iota 标示符，它简化了常量用于增长数字的定义，给以上相同的值以准确的分类。
const ( CategoryBooks = iota // 0  CategoryHealth // 1  CategoryClothing // 2 )  自定义类型 自增长常量经常包含一个自定义类型，允许你依靠编译器。">
<meta name="author" content="">
<link rel="canonical" href="https://timliudream.github.io/posts/golang/iota/" />















<link href="https://timliudream.github.io/css/stylesheet.min.b760220717cab18f5ad50547f90cca998a768de2def38cc7547d38fe469c80e0.css" integrity="sha256-t2AiBxfKsY9a1QVH&#43;QzKmYp2jeLe84zHVH04/kacgOA=" rel="preload stylesheet"
    as="style">


<link rel="apple-touch-icon" href="https://timliudream.github.io/apple-touch-icon.png">
<link rel="icon" href="https://timliudream.github.io/favicon.ico">
<meta name="generator" content="Hugo 0.75.1" />


</head>

<body
    class="single dark "
    id="top">
<header class="header">
    <nav class="nav">
        <p class="logo"><a href="https://timliudream.github.io/">tim</a></p>
    </nav>
</header>
    <main class="main">

<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">
      golang中的iota用法
    </h1>
    
    <div class="post-meta">
      <time>September 21, 2020</time>
      
       . 3min read
    </div>
    
  </header>
  
  
  <div class="post-content"><p>有些概念有名字，并且有时候我们关注这些名字，甚至（特别）是在我们代码中。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">const</span> (
    <span style="color:#a6e22e">CCVisa</span>            = <span style="color:#e6db74">&#34;Visa&#34;</span>
    <span style="color:#a6e22e">CCMasterCard</span>      = <span style="color:#e6db74">&#34;MasterCard&#34;</span>
    <span style="color:#a6e22e">CCAmericanExpress</span> = <span style="color:#e6db74">&#34;American Express&#34;</span>
)
</code></pre></div><p>在其他时候，我们仅仅关注能把一个东西与其他的做区分。有些时候，有些时候一件事没有本质上的意义。比如，我们在一个数据库表中存储产品，我们可能不想以 string 存储他们的分类。我们不关注这个分类是怎样命名的，此外，该名字在市场上一直在变化。</p>
<p>我们仅仅关注它们是怎么彼此区分的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">const</span> (
    <span style="color:#a6e22e">CategoryBooks</span>    = <span style="color:#ae81ff">0</span>
    <span style="color:#a6e22e">CategoryHealth</span>   = <span style="color:#ae81ff">1</span>
    <span style="color:#a6e22e">CategoryClothing</span> = <span style="color:#ae81ff">2</span>
)
</code></pre></div><p>使用 0, 1, 和 2 代替，我们也可以选择 17， 43， 和 61。这些值是任意的。</p>
<p>常量是重要的，但是它们很难推断，并且难以维护。在一些语言中像 Ruby 开发者通常只是避免它们。在 Go，常量有许多微妙之处。当用好了，可以使得代码非常优雅且易维护的</p>
<hr>
<h3 id="自增长">自增长</h3>
<p>在 golang 中，一个方便的习惯就是使用 iota 标示符，它简化了常量用于增长数字的定义，给以上相同的值以准确的分类。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">const</span> (
    <span style="color:#a6e22e">CategoryBooks</span> = <span style="color:#66d9ef">iota</span> <span style="color:#75715e">// 0
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">CategoryHealth</span>       <span style="color:#75715e">// 1
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">CategoryClothing</span>     <span style="color:#75715e">// 2
</span><span style="color:#75715e"></span>)
</code></pre></div><hr>
<h3 id="自定义类型">自定义类型</h3>
<p>自增长常量经常包含一个自定义类型，允许你依靠编译器。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Stereotype</span> <span style="color:#66d9ef">int</span>

<span style="color:#66d9ef">const</span> (
    <span style="color:#a6e22e">TypicalNoob</span> <span style="color:#a6e22e">Stereotype</span> = <span style="color:#66d9ef">iota</span> <span style="color:#75715e">// 0
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">TypicalHipster</span>                <span style="color:#75715e">// 1
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">TypicalUnixWizard</span>             <span style="color:#75715e">// 2
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">TypicalStartupFounder</span>         <span style="color:#75715e">// 3
</span><span style="color:#75715e"></span>)
</code></pre></div><p>如果一个函数以 int 作为它的参数而不是 Stereotype，如果你给它传递一个 Stereotype，它将在编译器期出现问题。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">CountAllTheThings</span>(<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">string</span> {
                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;there are %d things&#34;</span>, <span style="color:#a6e22e">i</span>)
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#a6e22e">n</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">TypicalHipster</span>
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">CountAllTheThings</span>(<span style="color:#a6e22e">n</span>))
}

<span style="color:#75715e">// output:
</span><span style="color:#75715e">// cannot use TypicalHipster (type Stereotype) as type int in argument to CountAllTheThings
</span></code></pre></div><p>相反亦是成立的。给一个函数以 Stereotype 作为参数，你不能给它传递 int。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">SoSayethThe</span>(<span style="color:#a6e22e">character</span> <span style="color:#a6e22e">Stereotype</span>) <span style="color:#66d9ef">string</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>
    <span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">character</span> {
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">TypicalNoob</span>:
        <span style="color:#a6e22e">s</span> = <span style="color:#e6db74">&#34;I&#39;m a confused ninja rockstar.&#34;</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">TypicalHipster</span>:
        <span style="color:#a6e22e">s</span> = <span style="color:#e6db74">&#34;Everything was better we programmed uphill and barefoot in the snow on the SUTX 5918&#34;</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">TypicalUnixWizard</span>:
        <span style="color:#a6e22e">s</span> = <span style="color:#e6db74">&#34;sudo grep awk sed %!#?!!1!&#34;</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">TypicalStartupFounder</span>:
        <span style="color:#a6e22e">s</span> = <span style="color:#e6db74">&#34;exploit compelling convergence to syndicate geo-targeted solutions&#34;</span>
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">s</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">2</span>
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">SoSayethThe</span>(<span style="color:#a6e22e">i</span>))
}

<span style="color:#75715e">// output:
</span><span style="color:#75715e">// cannot use i (type int) as type Stereotype in argument to SoSayethThe
</span></code></pre></div><p>这是一个戏剧性的转折，尽管如此。你可以传递一个数值常量，然后它能工作。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">SoSayethThe</span>(<span style="color:#ae81ff">0</span>))
}

<span style="color:#75715e">// output:
</span><span style="color:#75715e">// I&#39;m a confused ninja rockstar.
</span></code></pre></div><p>这是因为常量在 Go 中是弱类型直到它使用在一个严格的上下文环境中。</p>
<hr>
<h3 id="skipping-values">Skipping Values</h3>
<p>设想你在处理消费者的音频输出。音频可能无论什么都没有任何输出，或者它可能是单声道，立体声，或是环绕立体声的。</p>
<p>这可能有些潜在的逻辑定义没有任何输出为 0，单声道为 1，立体声为 2，值是由通道的数量提供。</p>
<p>所以你给 Dolby 5.1 环绕立体声什么值。</p>
<p>一方面，它有6个通道输出，但是另一方面，仅仅 5 个通道是全带宽通道（因此 5.1 称号 - 其中 5.1 表示的是低频效果通道）。</p>
<p>不管怎样，我们不想简单的增加到 3。</p>
<p>我们可以使用下划线跳过不想要的值。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">AudioOutput</span> <span style="color:#66d9ef">int</span>

<span style="color:#66d9ef">const</span> (
    <span style="color:#a6e22e">OutMute</span> <span style="color:#a6e22e">AudioOutput</span> = <span style="color:#66d9ef">iota</span> <span style="color:#75715e">// 0
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">OutMono</span>                    <span style="color:#75715e">// 1
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">OutStereo</span>                  <span style="color:#75715e">// 2
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">_</span>
    <span style="color:#a6e22e">_</span>
    <span style="color:#a6e22e">OutSurround</span>                <span style="color:#75715e">// 5
</span><span style="color:#75715e"></span>)
</code></pre></div><hr>
<h3 id="表达式">表达式</h3>
<p><code>iota</code> 可以做更多事情，而不仅仅是 increment。更精确地说，<code>iota</code> 总是用于 increment，但是它可以用于表达式，在常量中的存储结果值。</p>
<p>这里我们创建一个常量用于位掩码。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Allergen</span> <span style="color:#66d9ef">int</span>

<span style="color:#66d9ef">const</span> (
    <span style="color:#a6e22e">IgEggs</span> <span style="color:#a6e22e">Allergen</span> = <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#66d9ef">iota</span> <span style="color:#75715e">// 1 &lt;&lt; 0 which is 00000001
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">IgChocolate</span>                         <span style="color:#75715e">// 1 &lt;&lt; 1 which is 00000010
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">IgNuts</span>                              <span style="color:#75715e">// 1 &lt;&lt; 2 which is 00000100
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">IgStrawberries</span>                      <span style="color:#75715e">// 1 &lt;&lt; 3 which is 00001000
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">IgShellfish</span>                         <span style="color:#75715e">// 1 &lt;&lt; 4 which is 00010000
</span><span style="color:#75715e"></span>)
</code></pre></div><p>这个工作是因为当你在一个 <code>const</code> 组中仅仅有一个标示符在一行的时候，它将使用增长的 <code>iota</code> 取得前面的表达式并且再运用它，。在 Go 语言的 <a href="http://golang.org/ref/spec#Iota">spec</a> 中， 这就是所谓的隐性重复最后一个非空的表达式列表。</p>
<p>如果你对鸡蛋，巧克力和海鲜过敏，把这些 bits 翻转到 “on” 的位置（从左到右映射 bits）。然后你将得到一个 bit 值 <code>00010011</code>，它对应十进制的 19。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">IgEggs</span> | <span style="color:#a6e22e">IgChocolate</span> | <span style="color:#a6e22e">IgShellfish</span>)

<span style="color:#75715e">// output:
</span><span style="color:#75715e">// 19
</span></code></pre></div><p>这是在 Effective Go 中一个非常好定义数量级的示例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ByteSize</span> <span style="color:#66d9ef">float64</span>

<span style="color:#66d9ef">const</span> (
    <span style="color:#a6e22e">_</span>           = <span style="color:#66d9ef">iota</span>                   <span style="color:#75715e">// ignore first value by assigning to blank identifier
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">KB</span> <span style="color:#a6e22e">ByteSize</span> = <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> (<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">iota</span>) <span style="color:#75715e">// 1 &lt;&lt; (10*1)
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">MB</span>                                   <span style="color:#75715e">// 1 &lt;&lt; (10*2)
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">GB</span>                                   <span style="color:#75715e">// 1 &lt;&lt; (10*3)
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">TB</span>                                   <span style="color:#75715e">// 1 &lt;&lt; (10*4)
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">PB</span>                                   <span style="color:#75715e">// 1 &lt;&lt; (10*5)
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">EB</span>                                   <span style="color:#75715e">// 1 &lt;&lt; (10*6)
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">ZB</span>                                   <span style="color:#75715e">// 1 &lt;&lt; (10*7)
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">YB</span>                                   <span style="color:#75715e">// 1 &lt;&lt; (10*8)
</span><span style="color:#75715e"></span>)
</code></pre></div><hr>
<h3 id="one-more-thing">one more thing</h3>
<p>当你在把两个常量定义在一行的时候会发生什么？</p>
<p>Banana 的值是什么？ 2 还是 3？ Durian 的值又是？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">const</span> (
    <span style="color:#a6e22e">Apple</span>, <span style="color:#a6e22e">Banana</span> = <span style="color:#66d9ef">iota</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">iota</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>
    <span style="color:#a6e22e">Cherimoya</span>, <span style="color:#a6e22e">Durian</span>
    <span style="color:#a6e22e">Elderberry</span>, <span style="color:#a6e22e">Fig</span>
)
</code></pre></div><p>iota 在下一行增长，而不是立即取得它的引用。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Apple: 1
</span><span style="color:#75715e">// Banana: 2
</span><span style="color:#75715e">// Cherimoya: 2
</span><span style="color:#75715e">// Durian: 3
</span><span style="color:#75715e">// Elderberry: 3
</span><span style="color:#75715e">// Fig: 4
</span></code></pre></div></div>
  <footer class="post-footer">
    
  </footer>
</article>


    </main><footer class="footer">
    <span>&copy; 2020 <a href="https://timliudream.github.io/">tim</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</span>
    <span>&middot;</span>
    <span>Theme️ <a href="https://github.com/adityatelange/hugo-PaperMod" rel="noopener"
            target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top">
    <button class="top-link" id="top-link" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6">
            <path d="M12 6H0l6-6z" /></svg>
    </button>
</a>


<script src="https://timliudream.github.io/js/highlight.min.min.e7afc2928c0925d65c4732dfebe147014d91299a98e819e4b42f25c4fa68e91c.js" integrity="sha256-56/CkowJJdZcRzLf6&#43;FHAU2RKZqY6BnktC8lxPpo6Rw="></script>

<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }
    
    hljs.initHighlightingOnLoad();
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();

            document.querySelector(this.getAttribute("href")).scrollIntoView({
                behavior: "smooth"
            });
        });
    });
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }
</script>
</body>

</html>